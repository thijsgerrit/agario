# AGAR.IO
import pygame
import random
import math

name_of_player = input("What is your name?:  ")
number_of_bots = int(input('With how many bots you want to play?:   '))

# initialize all imported pygame modules + text for game over
pygame.init()
pygame.font.init()

# Set screen size properties
width_screen = 1000
height_screen = 1000
screen = pygame.display.set_mode((width_screen, height_screen))
pygame.display.set_caption("Agar Python")

# text for game over
used_font_game_over = pygame.font.SysFont('freesansbold.ttf', 150)
text_surface = used_font_game_over.render('GAME OVER', True, (0, 0, 0))
text_rect = text_surface.get_rect()
text_rect.center = ((width_screen/2), (height_screen/2))

# test for


# Generating random colors for food
colors = []
i = 0
while i < 100:
    red_colour = random.randint(0, 255)
    green_colour = random.randint(0, 255)
    blue_colour = random.randint(0, 255)
    colors.append((red_colour, green_colour, blue_colour))
    i += 1

# Time counter
t0 = float(pygame.time.get_ticks()) / 1000.
tnow = float(pygame.time.get_ticks()) / 1000.

# VARIABLE
begin_food_list = []
colour_player = random.choice(colors)
colour_background = (255, 255, 255)
colour_text = (0, 0, 0)
food_radius = []
food_location = []
food_colour = []
food_x_coordinate = []
food_y_coordinate = []

x_player = width_screen/2
y_player = height_screen/2
position_player = [int(x_player), int(y_player)]

minimum_speed = 25
maximum_speed = 600
maxdt = 0.002
coefficient = 1.1


class Food:
    """Generates food particles and the choose a random position to deploy them, code also deploys them"""
    def __init__(self):
        """This will generate a random x position, y position, color and radius for the food"""
        self.radius = random.randint(5, 8)
        self.x_coordinate_food = random.randint(self.radius, width_screen-self.radius)
        self.y_coordinate_food = random.randint(self.radius, height_screen-self.radius)

        self.location = [self.x_coordinate_food, self.y_coordinate_food]
        self.colour = random.choice(colors)

        food_radius.append(self.radius)
        food_x_coordinate.append(self.x_coordinate_food)
        food_y_coordinate.append(self.y_coordinate_food)
        food_location.append(self.location)
        food_colour.append(self.colour)


class Player:
    """All attributes of the player will be coded here"""
    def __init__(self):
        """This will generate all the standard parameters of the player"""
        self.player_speed = 25
        self.radius = 20
        self.new_radius_player = 20
        self.x_coordinate = random.randint(self.radius, width_screen-self.radius)
        self.y_coordinate = random.randint(self.radius, height_screen-self.radius)

        self.location = [self.x_coordinate, self.y_coordinate]
        self.colour = random.choice(colors)
        self.colour1 = random.choice(colors)
        self.new_bot1, self.new_bot2, self.new_bot3, self.new_bot4 = False, False, False, False

    def new_radius(self):
        """Determine if the player eats the food"""
        for i in range(len(food_location)):
            x_distance_food = self.x_coordinate - food_x_coordinate[i]
            y_distance_food = self.y_coordinate - food_y_coordinate[i]
            distance_food = math.sqrt(x_distance_food**2+y_distance_food**2)

            if distance_food <= self.radius:
                area_food = math.pi * food_radius[i] ** 2
                area_player = math.pi * self.new_radius_player ** 2
                new_area_player = area_food + area_player
                self.new_radius_player = math.sqrt(new_area_player/math.pi)
                self.radius = int(self.new_radius_player)
                del food_radius[i]
                del food_colour[i]
                del food_location[i]
                del food_x_coordinate[i]
                del food_y_coordinate[i]
                break

        for i in range(len(bots)):
            if bots[i].radius + 5 < self.radius:
                x_distance = bots[i].x_coordinate - self.x_coordinate
                y_distance = bots[i].y_coordinate - self.y_coordinate
                distance = math.sqrt(x_distance**2+y_distance**2)

                if distance <= self.radius:
                    area_bot = math.pi * bots[i].radius ** 2
                    area_player = math.pi * self.new_radius_player ** 2
                    new_area_player = area_player + area_bot
                    print(str(area_bot) + ' + ' + str(area_player) + ' = ' + str(new_area_player))
                    self.new_radius_player = math.sqrt(new_area_player/math.pi)
                    self.radius = int(self.new_radius_player)
                    bots[i].new_bot = True


    def move(self):
        x_position_cursor, y_position_cursor = pygame.mouse.get_pos()
        self.player_speed = max([minimum_speed, coefficient*maximum_speed/math.sqrt(self.radius)])

        # Subtract the position of the player from the position of the cursor to obtain a vector that indicates the
        # direction of movement
        move_vector = [x_position_cursor - self.x_coordinate, y_position_cursor - self.y_coordinate]
        move_vector_magnitude = math.sqrt(move_vector[0]**2 + move_vector[1]**2) /5               #Nog aanpassen

        self.x_coordinate += self.player_speed * move_vector[0] / move_vector_magnitude * dt
        self.y_coordinate += self.player_speed * move_vector[1] / move_vector_magnitude * dt

    def feed_players(self):
        pass

    def attack(self):
        pass

    def collision_explosion(self):
        pass

    def update_position(self):
        self.new_radius()
        self.move()
        self.collision_explosion()


class Bot:
    """This will generate random bots who will fight you in the game"""
    def __init__(self, bot_id):
        self.bot_id = bot_id
        self.radius = random.randint(10, player1.radius + 5)
        self.new_radius_bot = self.radius
        self.x_coordinate = random.randint(self.radius, width_screen-self.radius)
        self.y_coordinate = random.randint(self.radius, height_screen-self.radius)

        self.location = [self.x_coordinate, self.y_coordinate]
        self.colour = random.choice(colors)
        self.colour1 = random.choice(colors)
        self.speed_bot_y = 0
        self.speed_bot_x = 0
        self.angle = random.random() * 2 * math.pi

        self.bot_radius = []
        self.bot_x_coordinate = []
        self.bot_y_coordinate = []
        self.bot_location = []
        self.bot_colour = []

        self.bot_radius.append(self.radius)
        self.bot_x_coordinate.append(self.x_coordinate)
        self.bot_y_coordinate.append(self.y_coordinate)
        self.bot_location.append(self.location)
        self.bot_colour.append(self.colour)
        self.new_bot = False
        self.game_over = False

    def new_radius(self):
        for i in range(len(food_location)):
            x_distance = self.x_coordinate - food_x_coordinate[i]
            y_distance = self.y_coordinate - food_y_coordinate[i]
            distance = math.sqrt(x_distance**2+y_distance**2)

            if distance <= self.radius:
                area_food = math.pi * food_radius[i] ** 2
                area_bot = math.pi * self.new_radius_bot ** 2
                new_area_bot = area_food + area_bot
                self.new_radius_bot = math.sqrt(new_area_bot/math.pi)
                self.radius = int(self.new_radius_bot)
                del food_radius[i]
                del food_colour[i]
                del food_location[i]
                del food_x_coordinate[i]
                del food_y_coordinate[i]
                break

        if self.radius > player1.radius + 5:
            x_distance = self.x_coordinate - player1.x_coordinate
            y_distance = self.y_coordinate - player1.y_coordinate
            distance = math.sqrt(x_distance**2+y_distance**2)
            if distance <= self.radius:
                area_player = math.pi * player1.radius ** 2
                area_bot = math.pi * self.new_radius_bot ** 2
                new_area_bot = area_player + area_bot
                self.new_radius_bot = math.sqrt(new_area_bot/math.pi)
                self.radius = int(self.new_radius_bot)
                screen.blit(text_surface, text_rect)
                self.game_over = True

    def move(self):
        bot_speed = max(minimum_speed, coefficient*maximum_speed/math.sqrt(self.radius))
        if abs(self.x_coordinate - player1.x_coordinate) < 200 and abs(self.y_coordinate - player1.y_coordinate) < 200 and self.radius > (player1.radius + 5):
            self.angle = math.atan((self.y_coordinate - player1.y_coordinate)/(self.x_coordinate - player1.x_coordinate))
            if player1.x_coordinate < self.x_coordinate:
                self.speed_bot_y = bot_speed * -1 * math.sin(self.angle)
                self.speed_bot_x = bot_speed * -1 * math.cos(self.angle)
            elif player1.x_coordinate > self.x_coordinate:
                self.speed_bot_y = bot_speed * math.sin(self.angle)
                self.speed_bot_x = bot_speed * math.cos(self.angle)

            self.x_coordinate += self.speed_bot_x*dt
            self.y_coordinate += self.speed_bot_y*dt

        else:
            if self.x_coordinate - self.radius < 0:
                self.angle += math.pi
                self.x_coordinate += 1

            elif self.x_coordinate + self.radius > width_screen:
                self.angle += math.pi
                self.x_coordinate -= 1

            elif self.y_coordinate - self.radius < 0:
                self.angle += math.pi
                self.y_coordinate += 1

            elif self.y_coordinate + self.radius > height_screen:
                self.angle += math.pi
                self.y_coordinate -= 1

            self.speed_bot_y = bot_speed * math.sin(self.angle)
            self.speed_bot_x = bot_speed * math.cos(self.angle)
            self.x_coordinate += self.speed_bot_x*dt
            self.y_coordinate += self.speed_bot_y*dt

    def update_position(self):
        self.new_radius()
        self.move()

'''The code starts here'''
player1 = Player()
bots = [Bot(x) for x in range(number_of_bots)]

while True:
    tnow = float(pygame.time.get_ticks())/1000.
    dt = min((tnow-t0)*2, maxdt)
    screen.fill(colour_background)
    pygame.event.pump()

    # Making of the food particles in the beginning and when playing the game
    while len(food_location) < 500:
        food = Food()
    for j in range(len(food_location)):
        pygame.draw.circle(screen, food_colour[j], food_location[j], food_radius[j])

    #Update the position of the player and the bots
    player1.update_position()
    for i in range(len(bots)):
        bots[i].update_position()

    #Print the bots and the players
    pygame.draw.circle(screen, player1.colour, (int(player1.x_coordinate), int(player1.y_coordinate)), player1.radius)
    pygame.draw.circle(screen, player1.colour1, (int(player1.x_coordinate), int(player1.y_coordinate)), int(6/7 * player1.radius))
    for i in range(len(bots)):
        if bots[i].radius != 0:
            pygame.draw.circle(screen, bots[i].colour, (int(bots[i].x_coordinate), int(bots[i].y_coordinate)), bots[i].radius)
            pygame.draw.circle(screen, bots[i].colour1, (int(bots[i].x_coordinate), int(bots[i].y_coordinate)), int(6/7 * bots[i].radius))


    for i in range(len(bots)):
        while bots[i].new_bot:
            bots[i] = Bot(i)
            bots[i].new_bot = False


    #Initiate game over if eaten by bigger bot
    for i in range(len(bots)):
        while bots[i].game_over:
            pygame.display.update()

    #Initiat succes
    if player1.radius > 500:




    #Print text for name
    used_font_name = pygame.font.SysFont('freesansbold.ttf', int(3.5*player1.radius/len(name_of_player)))
    text_name = used_font_name.render(name_of_player, True, (0, 0, 0))
    text_rect_name = text_name.get_rect()
    text_rect_name.center = (player1.x_coordinate, player1.y_coordinate)
    screen.blit(text_name, text_rect_name)

    pygame.display.flip()
